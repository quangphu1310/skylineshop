@*@model SkyLineShop.Models.Product*@
@{
    ViewBag.Title = "ProductDetail";
    Layout = "~/Views/Shared/_LayoutContainer.cshtml";
}


<!-- Shop Details Section Begin -->
<section class="shop-details">
    <div class="product__details__pic">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__breadcrumb">
                        <a href="~/Home">Trang Chủ</a>
                        <a href="~/Shop">Shop</a>
                        <span>@ViewBag.product.product_name</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <ul class="nav nav-tabs" role="tablist">
                        @{
                            int i = 1;
                            int j = 1;
                            string[] imageUrls = new string[ViewBag.Img.Count];
                            int index = 0;
                        }

                        @foreach (var a in ViewBag.Img)
                        {
                            imageUrls[index] = a.image;
                            <li class="nav-item quangla">
                                <a class="nav-link active"
                                   data-toggle="tab-@i"
                                   href="#tabs-@i"
                                   role="tab">
                                    <div class="product__thumb__pic set-bg"
                                         data-setbg="/Assets/img/product/@a.image"></div>
                                </a>
                            </li>
                            i++;
                        }


                    </ul>
                </div>
                <div class="col-lg-6 col-md-9">
                    <div class="tab-content">
                        @foreach (var a in ViewBag.Img)
                        {
                            <div class="tab-pane quangphu @(j==1 ? "active": "")" id="tabs-@j" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="/Assets/img/product/@a.image" alt="" />
                                </div>
                            </div>
                            j++;
                        }

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="product__details__content">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-lg-8">
                    <div class="product__details__text">
                        <h4>@ViewBag.Product.product_name</h4>
                        <div class="rating">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-o"></i>
                            <span> - 5 Reviews</span>
                        </div>
                        <h3>@String.Format("{0:0,0}", @ViewBag.Product.price) <span>@String.Format("{0:0,0}", @ViewBag.Product.price)</span></h3>
                        <p>
                            @ViewBag.Product.desc
                        </p>
                        <div class="product__details__option">
                            @{
                                if ((ViewBag.Product.id_cate) == 1 || (ViewBag.Product.id_cate) == 2)
                                {
                                    <div class="product__details__option__size">
                                        <span>Size:</span>
                                        <label for="xxl">
                                            XXL
                                            <input type="radio" id="xxl" value="XXL" name="size-radio" />
                                        </label>
                                        <label class="active" for="xl" name="size-radio">
                                            XL
                                            <input type="radio" id="xl" checked value="XL" name="size-radio" />
                                        </label>
                                        <label for="l">
                                            L
                                            <input type="radio" id="l" value="L" name="size-radio" />
                                        </label>
                                        <label for="m">
                                            M
                                            <input type="radio" id="m" value="M" name="size-radio" />
                                        </label>
                                    </div>
                                }
                                else if ((ViewBag.Product.id_cate) == 3)
                                {
                                    <div class="product__details__option__size">
                                        <span>Size:</span>
                                        <label for="size_42">
                                            42
                                            <input type="radio" id="size_42" value="42" name="size-radio" />
                                        </label>
                                        <label class="active" for="size_41">
                                            41
                                            <input type="radio" id="size_41" checked value="41" name="size-radio" />
                                        </label>
                                        <label for="size_40">
                                            40
                                            <input type="radio" id="size_40" value="40" name="size-radio" />
                                        </label>
                                        <label for="size_39">
                                            39
                                            <input type="radio" id="size_39" value="39" name="size-radio" />
                                        </label>
                                    </div>

                                }
                                else
                                {

                                }
                            }



                        </div>
                        <div class="product__details__cart__option">
                            <div class="quantity">
                                <div class="pro-qty">
                                    <span class="fa fa-angle-down inc qtybtn"></span>

                                    <input type="text" value="1" id="quantity_detial" />
                                    <span class="fa fa-angle-up dec qtybtn"></span>
                                </div>
                            </div>
                            <a href="#" type="button" class="add-to-cart-button cart-detail btn-primary"
                                       data-product-id="@ViewBag.Product.id_product"
                                        data-image="@ViewBag.Img[0].image">add to cart</a>
                        </div>

                        <div class="product__details__last__option">
                            <h5><span>Guaranteed Safe Checkout</span></h5>
                            <img src="/Assets/img/shop-details/details-payment.png" alt="" />
                            <ul>
                                @*<li><span>SKU:</span> 3812912</li>*@
                                <li><span>Categories:</span> <a href="~/Shop?categoryID=@ViewBag.product.id_cate">@ViewBag.product.Category.cate_name</a>, <a href="~/Shop?brandID=@ViewBag.product.id_brand">@ViewBag.product.Brand.brand_name</a> </li>
                                @*<li><span>Tag:</span> Clothes, Skin, Body</li>*@
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active"
                                   data-toggle="tab"
                                   href="#tabs-5"
                                   role="tab">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                   data-toggle="tab"
                                   href="#tabs-6"
                                   role="tab">Customer Previews(5)</a>
                            </li>
                            
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                <div class="product__details__tab__content">
                                    <p class="note">
                                        @ViewBag.product.desc
                                    </p>
                                    @*<div class="product__details__tab__content__item">
                                        <h5>Products Infomation</h5>
                                        <p>
                                            A Pocket PC is a handheld computer, which features
                                            many of the same capabilities as a modern PC. These
                                            handy little devices allow individuals to retrieve and
                                            store e-mail messages, create a contact file,
                                            coordinate appointments, surf the internet, exchange
                                            text messages and more. Every product that is labeled
                                            as a Pocket PC must be accompanied with specific
                                            software to operate the unit and must feature a
                                            touchscreen and touchpad.
                                        </p>
                                        <p>
                                            As is the case with any new technology product, the
                                            cost of a Pocket PC was substantial during it’s early
                                            release. For approximately $700.00, consumers could
                                            purchase one of top-of-the-line Pocket PCs in 2003.
                                            These days, customers are finding that prices have
                                            become much more reasonable now that the newness is
                                            wearing off. For approximately $350.00, a new Pocket
                                            PC can now be purchased.
                                        </p>
                                    </div>
                                    <div class="product__details__tab__content__item">
                                        <h5>Material used</h5>
                                        <p>
                                            Polyester is deemed lower quality due to its none
                                            natural quality’s. Made from synthetic materials, not
                                            natural like wool. Polyester suits become creased
                                            easily and are known for not being breathable.
                                            Polyester suits tend to have a shine to them compared
                                            to wool and cotton suits, this can make the suit look
                                            cheap. The texture of velvet is luxurious and
                                            breathable. Velvet is a great choice for dinner party
                                            jacket and can be worn all year round.
                                        </p>
                                    </div>*@
                                </div>
                            </div>
                            <div class="tab-pane" id="tabs-6" role="tabpanel">
                                <div class="product__details__tab__content">
                                    <div class="product__details__tab__content__item">
                                        <h5>Products Infomation</h5>
                                        <p>
                                            A Pocket PC is a handheld computer, which features
                                            many of the same capabilities as a modern PC. These
                                            handy little devices allow individuals to retrieve and
                                            store e-mail messages, create a contact file,
                                            coordinate appointments, surf the internet, exchange
                                            text messages and more. Every product that is labeled
                                            as a Pocket PC must be accompanied with specific
                                            software to operate the unit and must feature a
                                            touchscreen and touchpad.
                                        </p>
                                        <p>
                                            As is the case with any new technology product, the
                                            cost of a Pocket PC was substantial during it’s early
                                            release. For approximately $700.00, consumers could
                                            purchase one of top-of-the-line Pocket PCs in 2003.
                                            These days, customers are finding that prices have
                                            become much more reasonable now that the newness is
                                            wearing off. For approximately $350.00, a new Pocket
                                            PC can now be purchased.
                                        </p>
                                    </div>
                                    <div class="product__details__tab__content__item">
                                        <h5>Material used</h5>
                                        <p>
                                            Polyester is deemed lower quality due to its none
                                            natural quality’s. Made from synthetic materials, not
                                            natural like wool. Polyester suits become creased
                                            easily and are known for not being breathable.
                                            Polyester suits tend to have a shine to them compared
                                            to wool and cotton suits, this can make the suit look
                                            cheap. The texture of velvet is luxurious and
                                            breathable. Velvet is a great choice for dinner party
                                            jacket and can be worn all year round.
                                        </p>
                                    </div>
                                </div>
                            </div>
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Shop Details Section End -->
<!-- Related Section Begin -->
<section class="related spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="related-title">Related Product</h3>
            </div>
        </div>
        <div class="row">
            @foreach (var item in ViewBag.relatedProduct)
            {
                var productImage = item.Product_Image[0];
                <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6">
                    <div class="product__item">
                        <div class="product__item__pic set-bg"
                             data-setbg="/Assets/img/product/@productImage.image">
                            @*<span class="label">New</span>*@
                            <ul class="product__hover">
                                <li>
                                    <a href="#"><img src="/Assets/img/icon/cart.png" alt="" /></a>
                                    <span>Add To Cart</span>
                                </li>
                            </ul>
                        </div>
                        <div class="product__item__text">
                            <h6>@item.product_name</h6>
                            @*<a href="#" class="add-cart"><i class="fa-solid fa-cart-plus"></i>Thêm vào giỏ hàng</a>*@
                            <div class="rating">
                                <i class="fa fa-star-o"></i>
                                <i class="fa fa-star-o"></i>
                                <i class="fa fa-star-o"></i>
                                <i class="fa fa-star-o"></i>
                                <i class="fa fa-star-o"></i>
                            </div>
                            <h5>@String.Format("{0:0,0}",item.price)</h5>
                        </div>
                    </div>
                </div>

            }
        </div>
    </div>
</section>


<!-- Related Section End -->
@section scripts{
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <script>
        

        //dùng ajax cho giỏ hàng
        $(document).ready(function () {
            $(".add-to-cart-button").click(function (e) {
                e.preventDefault();

                var productID = $(this).data("product-id");
                var quantity = $("#quantity_detial").val();
                var size = $("input[name='size-radio']:checked").val();
                var image = $(this).data("image");

                $.ajax({
                    url: '/Cart/AddItem', // Điều hướng tới action xử lý thêm sản phẩm vào giỏ hàng
                    method: 'POST',
                    data: {
                        productid: productID,
                        quantity: quantity,
                        size: size,
                        image: image
                    },
                    success: function (response) {
                        if (response.success) {
                            // Thực hiện các hành động sau khi thêm sản phẩm thành công
                            const Toast = Swal.mixin({
                                toast: true,
                                position: 'top-right',
                                showConfirmButton: false,
                                timer: 3000,
                                timerProgressBar: true,
                                didOpen: (toast) => {
                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                }
                            })

                            Toast.fire({
                                icon: 'success',
                                title: 'Thêm vào giỏ hàng thành công'
                            })
                            var itemCount = response.countCart;
                            $('#CartCount').text(itemCount);
                        } else {
                            // Xử lý khi có lỗi
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: 'Something went wrong!'
                            })
                        }
                    },
                    error: function (xhr, status, error) {
                        // Xử lý khi có lỗi Ajax
                        alert("Lỗi Ajax: " + error);
                    }
                });
            });
        });

    </script>
}
